#!/bin/bash
set -e

echo "--- STARTING DEPLOYMENT ---"

# 1. Install PHP Dependencies
echo "Installing Composer..."
composer install --no-interaction --prefer-dist --optimize-autoloader

# 2. Update Database
echo "Migrating Database..."
php artisan migrate --force

# 3. Clear Caches
echo "Clearing Caches..."
php artisan config:clear
php artisan route:clear
php artisan view:clear

# 4. Build Frontend
echo "Building Frontend..."
npm ci
npm run build

echo "--- DEPLOYMENT SUCCESS ---"
