import{_ as X}from"./AuthenticatedLayout-C5Pp22y5.js";import{r as s,A as Z,L as V,B as ee,c as te,w as ae,b as e,f as C,n as w,t as g,g as v,i as f,o as d,I as se}from"./app-CJmeHOI5.js";import"./ApplicationLogo-DpBo3p9C.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"py-12 bg-slate-900 min-h-screen font-sans selection:bg-indigo-500 selection:text-white"},le={class:"max-w-6xl mx-auto flex flex-col items-center"},ne={class:"w-full flex justify-between items-end mb-6 px-4"},ie={class:"flex items-center gap-3"},re={class:"text-white font-mono text-xs"},ce={key:0,class:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none"},de={class:"bg-black/40 p-4 rounded-xl backdrop-blur-sm text-center"},ue={class:"text-indigo-400 text-[10px] mt-1"},ve={key:1,class:"absolute inset-0 flex flex-col items-center justify-center bg-slate-900/40 z-30 backdrop-blur-[2px]"},pe={key:2,class:"absolute inset-0 flex flex-col items-center justify-center bg-black/70 z-50 backdrop-blur-md"},ge={class:"relative"},me={class:"text-[12rem] leading-none font-black text-white drop-shadow-[0_0_30px_rgba(251,191,36,0.8)] font-variant-numeric tabular-nums"},fe={key:3,class:"absolute inset-0 z-40 pointer-events-none p-6 flex flex-col justify-between"},xe={class:"flex justify-between items-start"},be={class:"bg-black/60 backdrop-blur-md p-4 rounded-2xl border border-white/10 shadow-xl"},he={class:"bg-black/60 backdrop-blur-md px-6 py-3 rounded-full border border-white/10 shadow-xl"},we={class:"flex items-center gap-3"},ke={class:"relative flex h-3 w-3"},ye={key:0,class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"},_e={class:"flex justify-end items-end opacity-50 hover:opacity-100 transition-opacity"},Ce={class:"bg-black/80 backdrop-blur-md p-3 rounded-xl border border-white/10 text-right"},Se={class:"font-mono text-xs text-indigo-300"},Ie={class:"mt-8 grid grid-cols-1 gap-4 w-full max-w-md"},Ae={key:1,class:"flex gap-4"},Ne={__name:"PostureCamera",setup(De){const S=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",F=S?"http://127.0.0.1:5000/predict":"https://ergovision-ai.onrender.com/predict",G=S?"http://127.0.0.1:5000/":"https://ergovision-ai.onrender.com/";console.log(`Running in ${S?"LOCAL":"LIVE"} mode. Connecting to: ${F}`);const I=s(null),p=s(!1),k=s(!1),l=s(!1),i=s(!1),y=s(0),x=s(100),u=s(!1),o=s("Initializing..."),A=s({neck:0,back:0}),N=s(0),B=s(0),r=s([]),U=new Audio("/sounds/alert.mp3"),L=new Audio("/sounds/success.mp3");let b=null,_=null,D=Date.now(),E=0,h=null,m=null,j=0;const n=s({scores:[],slouchFrames:0,totalFrames:0,alerts:0}),$=async()=>{try{console.log("Pinging AI Server to wake up..."),await V.get(G,{timeout:3e3}),console.log("AI Server is AWAKE."),o.value="AI Ready"}catch{console.log("AI Server might be waking up (Cold Start)..."),o.value="Waking up AI..."}};Z(()=>{"Notification"in window&&Notification.permission!=="granted"&&Notification.requestPermission(),$(),window.Pose?(b=new window.Pose({locateFile:a=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${a}`}),b.setOptions({modelComplexity:1,smoothLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),b.onResults(W)):(console.error("MediaPipe Pose not loaded"),alert("Error: AI Libraries not loaded. Please refresh."))});const M=()=>{if(n.value.totalFrames===0)return;const a=Date.now(),t=Math.round((a-D)/1e3);D=a;const c=n.value.scores.length||1,P=Math.round(n.value.scores.reduce((R,Q)=>R+Q,0)/c),T=n.value.slouchFrames/n.value.totalFrames,Y=Math.round(T*t),J={score:P||100,slouch_duration:Y||0,duration_seconds:t||30,alert_count:n.value.alerts||0};se.post("/posture-chunks",J,{preserveScroll:!0,preserveState:!0,onSuccess:()=>{console.log(`Saved ${t}s chunk`),n.value={scores:[],slouchFrames:0,totalFrames:0,alerts:0}},onError:R=>console.error(R)})},H=a=>{if(a){m||(m=Date.now());const t=(Date.now()-m)/1e3;t>=15?(o.value="CRITICAL: SIT UP!",Date.now()-j>15e3&&(new Notification("Posture Alert",{body:"Sit up straight!"}),U.play().catch(()=>{}),n.value.alerts++,j=Date.now())):t>=5?o.value="Warning: Adjust Posture":o.value="Slouching Detected"}else m&&(Date.now()-m)/1e3>5?(L.play().catch(()=>{}),o.value="Great Correction!",setTimeout(()=>{u.value||(o.value="Good Posture")},2e3)):o.value="Good Posture",m=null},z=()=>{if(i.value||l.value)return;r.value=[],i.value=!0,y.value=5,o.value="Get Ready...";const a=setInterval(()=>{y.value--,y.value<=0&&(clearInterval(a),K())},1e3)},K=()=>{if(r.value.length<1){i.value=!1,alert("Calibration Failed: AI could not see you clearly. Please ensure good lighting and try again."),o.value="Calibration Failed";return}N.value=r.value.reduce((a,t)=>a+t.back,0)/r.value.length,B.value=r.value.reduce((a,t)=>a+t.neck,0)/r.value.length,l.value=!0,i.value=!1,o.value="Baseline Locked - Monitoring Started",L.play(),D=Date.now(),h&&clearInterval(h),h=setInterval(M,3e4)},W=async a=>{const t=Date.now();if(!a.poseLandmarks||a.poseLandmarks.length<25){k.value=!1;return}if(k.value=!0,!(t-E<200)){E=t;try{const c=await V.post(F,{landmarks:a.poseLandmarks,ideal_back:N.value,ideal_neck:B.value});if(A.value=c.data.angles,i.value&&(r.value.push(c.data.angles),r.value.length>15&&r.value.shift()),l.value){x.value=c.data.score;const P=c.data.label===1,T=x.value<75;u.value=P||T,H(u.value),n.value.scores.push(c.data.score),n.value.totalFrames++,u.value&&n.value.slouchFrames++}}catch(c){console.error("AI Server Error (might be waking up):",c)}}},q=async()=>{try{const a=await navigator.mediaDevices.getUserMedia({video:!0});_=new window.Camera(I.value,{onFrame:async()=>{b&&await b.send({image:I.value})},width:640,height:480}),_.start(),p.value=!0,l.value=!1}catch(a){alert("Camera Permission Denied. Please allow camera access in your browser settings."),console.error(a)}},O=()=>{p.value=!1,l.value=!1,i.value=!1,h&&(M(),clearInterval(h)),_&&_.stop()};return ee(()=>O()),(a,t)=>(d(),te(X,null,{default:ae(()=>[e("div",oe,[e("div",le,[e("div",ne,[t[0]||(t[0]=e("div",null,[e("h2",{class:"text-3xl font-black text-white tracking-tighter"},[C(" ERGO"),e("span",{class:"text-indigo-500"},"VISION")]),e("p",{class:"text-slate-400 text-sm font-mono uppercase tracking-widest"}," Real-Time Postural Inference Engine ")],-1)),e("div",ie,[e("div",{class:w(["h-3 w-3 rounded-full animate-pulse",l.value?"bg-emerald-500":p.value?"bg-amber-500":"bg-red-500"])},null,2),e("span",re,g(l.value?"SYSTEM ACTIVE":p.value?"STANDBY":"OFFLINE"),1)])]),e("div",{class:w(["relative bg-black rounded-3xl overflow-hidden transition-all duration-500 group",[l.value&&u.value?"shadow-[0_0_50px_rgba(239,68,68,0.6)] ring-4 ring-red-500":l.value?"shadow-[0_0_50px_rgba(16,185,129,0.4)] ring-4 ring-emerald-500":i.value?"ring-4 ring-amber-400 shadow-[0_0_50px_rgba(251,191,36,0.4)]":"shadow-2xl ring-1 ring-slate-700"]]),style:{width:"720px",height:"540px"}},[e("video",{ref_key:"videoRef",ref:I,class:"w-full h-full object-cover transform scale-x-[-1]",autoplay:"",playsinline:""},null,512),p.value&&!k.value?(d(),v("div",ce,[e("div",de,[t[1]||(t[1]=e("svg",{class:"animate-spin h-10 w-10 text-indigo-500 mx-auto mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),t[2]||(t[2]=e("p",{class:"text-white font-mono text-xs uppercase tracking-widest"},"Detecting Body...",-1)),e("p",ue,g(o.value),1)])])):f("",!0),p.value&&k.value&&!l.value&&!i.value?(d(),v("div",ve,[e("div",{class:"bg-black/80 p-8 rounded-3xl border border-white/10 text-center max-w-md shadow-2xl"},[t[4]||(t[4]=e("div",{class:"text-5xl mb-4"},"ðŸ§˜",-1)),t[5]||(t[5]=e("h3",{class:"text-white font-bold text-2xl mb-2"},"Calibration Required",-1)),t[6]||(t[6]=e("p",{class:"text-slate-400 text-sm mb-6 leading-relaxed"},[C(' Sit upright in your "Ideal" posture.'),e("br"),C(" Click below to start the 5-second lock. ")],-1)),e("button",{onClick:z,class:"w-full py-4 bg-gradient-to-r from-indigo-600 to-indigo-500 hover:from-indigo-500 hover:to-indigo-400 text-white font-bold rounded-xl shadow-lg transition-all flex items-center justify-center gap-2 group"},[...t[3]||(t[3]=[e("span",null,"START 5s CALIBRATION",-1)])])])])):f("",!0),i.value?(d(),v("div",pe,[e("div",ge,[e("h2",me,g(y.value),1),t[7]||(t[7]=e("p",{class:"text-amber-400 font-bold uppercase tracking-[0.5em] text-sm animate-pulse text-center mt-4"},"Stay Rigid",-1))])])):f("",!0),l.value?(d(),v("div",fe,[e("div",xe,[e("div",be,[t[9]||(t[9]=e("div",{class:"text-[10px] text-slate-400 uppercase tracking-widest font-bold mb-1"},"Posture Efficiency",-1)),e("div",{class:w(["text-5xl font-black tracking-tight",x.value>85?"text-emerald-400":x.value>70?"text-amber-400":"text-red-500"])},[C(g(x.value),1),t[8]||(t[8]=e("span",{class:"text-2xl align-top opacity-60"},"%",-1))],2)]),e("div",he,[e("div",we,[e("span",ke,[u.value?(d(),v("span",ye)):f("",!0),e("span",{class:w(["relative inline-flex rounded-full h-3 w-3",u.value?"bg-red-500":"bg-emerald-500"])},null,2)]),e("span",{class:w(["font-bold uppercase tracking-wider text-sm",u.value?"text-red-400":"text-emerald-400"])},g(o.value),3)])])]),e("div",_e,[e("div",Ce,[t[10]||(t[10]=e("div",{class:"text-[9px] text-slate-500 uppercase tracking-widest font-mono mb-1"},"Real-Time Telemetry",-1)),e("div",Se," NCK: "+g(A.value.neck)+"Â° | BCK: "+g(A.value.back)+"Â° ",1)])])])):f("",!0)],2),e("div",Ie,[p.value?(d(),v("div",Ae,[e("button",{onClick:O,class:"flex-1 py-4 bg-slate-800 hover:bg-red-600 hover:text-white text-slate-200 font-bold rounded-xl transition-colors shadow-lg border border-slate-700 uppercase tracking-wider text-sm"}," End Session & Save "),l.value?(d(),v("button",{key:0,onClick:z,class:"px-6 py-4 bg-slate-800 hover:bg-slate-700 text-indigo-400 hover:text-indigo-300 font-bold rounded-xl transition-colors shadow-lg border border-slate-700 uppercase tracking-wider text-sm",title:"Reset Baseline"},[...t[11]||(t[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])])):f("",!0)])):(d(),v("button",{key:0,onClick:q,class:"w-full py-5 bg-indigo-600 hover:bg-indigo-500 text-white font-black text-lg rounded-2xl shadow-lg shadow-indigo-500/20 transition-all hover:translate-y-[-2px] uppercase tracking-widest"}," Initialize Camera "))])])])]),_:1}))}};export{Ne as default};
