import{_ as Y}from"./AuthenticatedLayout-DqrN80cJ.js";import{u as J}from"./ToastList-BsYEA3by.js";import{k as i,K as X,x as Z,p as ee,E as te,G as ae,q as se,w as oe,b as t,d as le,t as k,u as e,o as S,c as D,i as F,n as T}from"./app-B6TZJ2Sj.js";import"./ApplicationLogo-_dr3x1Me.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function ne(z,p){const g=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"http://127.0.0.1:5000/predict":"https://ergovision-ai.onrender.com/predict",C=i(!1),c=i(!1),b=i(!1),f=i(!1),v=i(0),h=i(100),l=i(!1),a=i("Initializing..."),E=i(0),_=i({neck:0,back:0}),x=i([]),B=new Audio("/sounds/alert.mp3"),m=new Audio("/sounds/success.mp3");let w=0,P=0,u=[],y=0,s=null,L=0,R=null,I=null,A=0;const r=i({scores:[],slouchFrames:0,totalFrames:0,alerts:0}),H=Z(()=>{const o=Math.floor(E.value/60).toString().padStart(2,"0"),n=(E.value%60).toString().padStart(2,"0");return`${o}:${n}`}),G=o=>{if(o){s||(s=Date.now());const n=(Date.now()-s)/1e3;n>=60?(a.value="CRITICAL: POSTURAL RESET REQUIRED",p.error("High-risk duration exceeded. Please stand up and reset.",{timeout:0})):n>=15?(a.value="ALERT: SUSTAINED SLOUCH",Date.now()-L>15e3&&(Notification.permission==="granted"&&new Notification("Posture Alert",{body:"Audible Intervention Triggered."}),B.play().catch(()=>{}),r.value.alerts++,L=Date.now(),p.warning("Persistent deviation detected."))):n>=5?a.value="WARNING: DRIFT DETECTED":a.value="Monitoring Threshold..."}else s&&(Date.now()-s)/1e3>5?(m.play().catch(()=>{}),a.value="Stable State Restored"):a.value="Stable State",s=null},V=()=>{if(r.value.totalFrames===0||A===0)return;const o=A;A=0;const n=r.value.scores.length||1,N=Math.round(r.value.scores.reduce((M,O)=>M+O,0)/n),j=r.value.slouchFrames/r.value.totalFrames,d=Math.round(j*o);ee.post("/posture-chunks",{score:N,slouch_duration:d,duration_seconds:o,alert_count:r.value.alerts},{preserveScroll:!0,onSuccess:()=>{r.value={scores:[],slouchFrames:0,totalFrames:0,alerts:0}}})},$=async o=>{const n=Date.now();if(!o.poseLandmarks||o.poseLandmarks.length<25){c.value=!1,a.value="Searching...";return}const N=o.poseLandmarks;if(![8,12,24].every(d=>N[d].visibility>.5)){c.value=!1,a.value="Align with camera";return}if(N[24].y<.4){a.value="Standing - Paused";return}if(c.value=!0,!(n-y<200)){y=n;try{const d=await X.post(g,{landmarks:o.poseLandmarks,ideal_back:w,ideal_neck:P,is_calibrating:f.value});if(d.data.status==="calibration_error"){a.value="BAD POSTURE DETECTED";return}if(_.value=d.data.angles,f.value&&(u.push(d.data.angles),a.value="Sit Straight..."),b.value){x.value.push(d.data.score),x.value.length>5&&x.value.shift();const M=x.value.reduce((q,K)=>q+K,0)/x.value.length,O=Math.round(M);Math.abs(h.value-O)>=1&&(h.value=O),l.value=d.data.label===1||h.value<75,G(l.value),r.value.scores.push(h.value),r.value.totalFrames++,l.value&&r.value.slouchFrames++}}catch{a.value="AI Offline"}}},W=()=>{f.value=!0,v.value=5,u=[];const o=setInterval(()=>{a.value!=="BAD POSTURE DETECTED"&&v.value--,v.value<=0&&(clearInterval(o),Q())},1e3)},Q=()=>{if(u.length<5){f.value=!1,p.error("Calibration failed. Please sit straight.");return}w=u.reduce((o,n)=>o+n.back,0)/u.length,P=u.reduce((o,n)=>o+n.neck,0)/u.length,b.value=!0,f.value=!1,p.success("Calibration complete!"),m.play().catch(()=>{}),I&&clearInterval(I),R&&clearInterval(R),A=0,I=setInterval(()=>{b.value&&c.value&&a.value!=="Standing - Paused"&&(E.value++,A++)},1e3),R=setInterval(V,3e4)};return{isCameraOn:C,isDetected:c,isCalibrated:b,isLocking:f,calibrationCountdown:v,currentScore:h,isSlouching:l,statusMessage:a,formattedDuration:H,angles:_,onResults:$,triggerCalibration:W,sessionDurationSecs:E,cleanup:()=>{I&&clearInterval(I),R&&clearInterval(R),b.value&&V()}}}const ie={class:"py-6 md:py-12 bg-[#020617] min-h-screen"},re={class:"max-w-5xl mx-auto flex flex-col items-center px-4"},ce={class:"w-full flex justify-between items-end mb-8"},ue={class:"text-slate-400 text-[10px] uppercase font-bold tracking-widest"},de={key:0,class:"text-right tabular-nums"},pe={class:"text-2xl font-mono font-bold text-white"},fe={key:0,class:"absolute inset-0 flex flex-col items-center justify-center bg-slate-950/90 backdrop-blur-md z-50"},ve={key:1,class:"absolute inset-0 flex flex-col items-center justify-center bg-black/60 backdrop-blur-sm z-40"},me={class:"flex justify-between items-start"},ge={class:"bg-slate-950/80 backdrop-blur-md p-4 rounded-3xl border border-white/10 shadow-2xl"},be={class:"bg-slate-950/80 backdrop-blur-md px-6 py-3 rounded-full border border-white/10 flex items-center gap-3"},he={class:"text-xs font-black uppercase tracking-widest text-white"},xe={class:"mt-10 w-full max-w-xl"},we={key:1,class:"flex gap-4"},Ce={__name:"PostureCamera",setup(z){const p=i(null),U=J(),{isCameraOn:g,isDetected:C,isCalibrated:c,isLocking:b,calibrationCountdown:f,currentScore:v,isSlouching:h,statusMessage:l,formattedDuration:a,onResults:E,triggerCalibration:_,sessionDurationSecs:x,cleanup:B}=ne(p,U);let m=null,w=null;te(()=>{window.Pose&&(m=new window.Pose({locateFile:y=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${y}`}),m.setOptions({modelComplexity:1,smoothLandmarks:!0,minDetectionConfidence:.5}),m.onResults(E))});const P=async()=>{try{w=new window.Camera(p.value,{onFrame:async()=>{m&&await m.send({image:p.value})},width:640,height:480}),w.start(),g.value=!0,x.value=0}catch{U.error("Camera Access Denied")}},u=()=>{w&&w.stop(),g.value=!1,B()};return ae(()=>u()),(y,s)=>(S(),se(Y,null,{default:oe(()=>[t("div",ie,[t("div",re,[t("div",ce,[t("div",null,[s[1]||(s[1]=t("h2",{class:"text-3xl font-black text-white tracking-tighter uppercase"},[le("ERGO"),t("span",{class:"text-indigo-500"},"VISION")],-1)),t("p",ue,k(e(c)?"ACTIVE":"READY"),1)]),e(g)?(S(),D("div",de,[s[2]||(s[2]=t("p",{class:"text-[10px] font-black text-indigo-400 uppercase mb-1"},"Active Duration",-1)),t("p",pe,k(e(a)),1)])):F("",!0)]),t("div",{class:T(["relative w-full aspect-video bg-black rounded-[3rem] overflow-hidden shadow-2xl border border-white/5 transition-all duration-500",{"ring-4 ring-emerald-500/50":e(l)==="Stable State","ring-4 ring-amber-500/50 animate-pulse":e(l)==="WARNING: DRIFT DETECTED","ring-4 ring-rose-500 shadow-rose-900/40":e(l)==="ALERT: SUSTAINED SLOUCH","ring-8 ring-rose-700 shadow-2xl":e(l)==="CRITICAL: POSTURAL RESET REQUIRED","opacity-50 grayscale":!e(C)||e(l)==="Standing - Paused"}])},[t("video",{ref_key:"videoRef",ref:p,class:"w-full h-full object-cover scale-x-[-1]",autoplay:"",playsinline:""},null,512),e(b)?(S(),D("div",fe,[t("h2",{class:T(["text-[10rem] font-black leading-none",e(l)==="BAD POSTURE DETECTED"?"text-rose-500":"text-white"])},k(e(f)),3),t("p",{class:T(["font-black uppercase tracking-[0.3em] text-xs mt-4",e(l)==="BAD POSTURE DETECTED"?"text-rose-400 animate-pulse":"text-amber-400"])},k(e(l)==="BAD POSTURE DETECTED"?"Sit Straight to Resume":"Calibrating Baseline..."),3)])):F("",!0),e(g)&&e(c)&&(!e(C)||e(l)==="Standing - Paused")?(S(),D("div",ve,[...s[3]||(s[3]=[t("svg",{class:"animate-spin h-10 w-10 text-indigo-500 mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),t("p",{class:"text-white font-black text-xs uppercase tracking-[0.3em]"},"Tracking Paused",-1),t("p",{class:"text-slate-400 text-[10px] mt-2"},"Waiting for user to return...",-1)])])):F("",!0),e(c)?(S(),D("div",{key:2,class:T(["absolute inset-0 p-8 flex flex-col justify-between pointer-events-none transition-opacity duration-300",!e(C)||e(l)==="Standing - Paused"?"opacity-0":"opacity-100"])},[t("div",me,[t("div",ge,[s[4]||(s[4]=t("p",{class:"text-[10px] font-black text-slate-500 uppercase mb-1"},"Efficiency",-1)),t("div",{class:T(["text-5xl font-black tabular-nums",e(v)>85?"text-emerald-400":e(v)>70?"text-amber-400":"text-rose-500"])},k(e(v))+"% ",3)]),t("div",be,[t("span",{class:T(["h-3 w-3 rounded-full",e(h)?"bg-rose-500 animate-ping":"bg-emerald-500"])},null,2),t("span",he,k(e(l)),1)])])],2)):F("",!0)],2),t("div",xe,[e(g)?(S(),D("div",we,[t("button",{onClick:u,class:"flex-1 py-4 bg-slate-800 text-white font-black rounded-2xl border border-white/5 uppercase text-xs hover:bg-rose-600 transition-colors"},"End Session"),t("button",{onClick:s[0]||(s[0]=(...L)=>e(_)&&e(_)(...L)),class:"flex-[2] py-4 bg-indigo-600 text-white font-black rounded-2xl shadow-xl uppercase text-xs hover:bg-indigo-500 transition-colors"},k(e(c)?"Recalibrate":"Start 5s Lock"),1)])):(S(),D("button",{key:0,onClick:P,class:"w-full py-5 bg-indigo-600 hover:bg-indigo-500 text-white font-black rounded-[2rem] shadow-2xl uppercase tracking-widest"}," Initialize Engine "))])])])]),_:1}))}};export{Ce as default};
