import{_ as oe}from"./AuthenticatedLayout-C8DnHD5f.js";import{E as ne,K as W,G as re,q as ie,w as ue,b as e,d as ce,o as u,c,t as h,i as x,n as I,k as l,x as de,p as ve}from"./app-BhE9kl-v.js";import{u as me}from"./ToastList-yaBtpd9_.js";import"./ApplicationLogo-BShF3MQs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const fe={class:"py-6 md:py-12 bg-slate-900 min-h-screen font-sans selection:bg-indigo-500 selection:text-white"},pe={class:"max-w-6xl mx-auto flex flex-col items-center"},ge={class:"w-full flex justify-between items-end mb-4 md:mb-6 px-4"},he={class:"flex flex-col items-end gap-1"},xe={key:0,class:"font-mono text-xl md:text-2xl font-bold text-white tabular-nums tracking-widest"},be={class:"flex items-center gap-2"},we={class:"text-white font-mono text-[10px] md:text-xs"},ke={key:0,class:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none bg-black/50 backdrop-blur-sm"},ye={key:1,class:"absolute inset-0 flex flex-col items-center justify-center bg-slate-900/60 z-30 backdrop-blur-sm p-4"},_e={key:2,class:"absolute inset-0 flex flex-col items-center justify-center bg-black/80 z-50 backdrop-blur-md"},Ce={class:"text-9xl font-black text-white font-variant-numeric tabular-nums"},Se={key:3,class:"absolute inset-0 z-40 pointer-events-none p-4 md:p-6 flex flex-col justify-between"},Ie={class:"flex justify-between items-start"},De={class:"bg-black/60 backdrop-blur-md p-3 rounded-xl border border-white/10 shadow-lg"},Pe={class:"bg-black/60 backdrop-blur-md px-4 py-2 rounded-full border border-white/10 shadow-lg"},Ae={class:"flex items-center gap-2"},Fe={class:"relative flex h-2 w-2"},Ne={key:0,class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"},Te={class:"flex justify-end items-end opacity-60"},Me={class:"bg-black/80 backdrop-blur-md p-2 rounded-lg border border-white/10 text-right"},Be={class:"font-mono text-[10px] text-indigo-300"},Ee={class:"mt-6 md:mt-8 w-full max-w-md px-4"},Le={key:1,class:"flex gap-3"},Ge={__name:"PostureCamera",setup(je){const E=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",K=E?"http://127.0.0.1:5000/predict":"https://ergovision-ai.onrender.com/predict",Y=E?"http://127.0.0.1:5000/":"https://ergovision-ai.onrender.com/",f=me(),F=l(null),d=l(!1),p=l(!1),o=l(!1),i=l(!1),D=l(0),g=l(100),v=l(!1),s=l("Initializing..."),P=l(0),N=l({neck:0,back:0}),L=l(0),j=l(0),b=l([]),k=l([]),J=new Audio("/sounds/alert.mp3"),R=new Audio("/sounds/success.mp3");let y=null,A=null,T=Date.now(),V=0,_=null,C=null,w=null,z=0;const r=l({scores:[],slouchFrames:0,totalFrames:0,alerts:0}),Q=de(()=>{const a=Math.floor(P.value/60).toString().padStart(2,"0"),t=(P.value%60).toString().padStart(2,"0");return`${a}:${t}`}),X=async()=>{try{await W.get(Y,{timeout:3e3}),s.value="AI Ready"}catch{s.value="Waking up AI..."}};ne(()=>{"Notification"in window&&Notification.permission!=="granted"&&Notification.requestPermission(),X(),window.Pose?(y=new window.Pose({locateFile:a=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${a}`}),y.setOptions({modelComplexity:1,smoothLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),y.onResults(te)):f.error("Could not load AI libraries. Please refresh.","System Error")});const O=()=>{if(r.value.totalFrames===0)return;const a=Date.now(),t=Math.round((a-T)/1e3);T=a;const m=r.value.scores.length||1,M=Math.round(r.value.scores.reduce((S,B)=>S+B,0)/m),H=r.value.slouchFrames/r.value.totalFrames,$=Math.round(H*t),n={score:M||100,slouch_duration:$||0,duration_seconds:t||30,alert_count:r.value.alerts||0};ve.post("/posture-chunks",n,{preserveScroll:!0,preserveState:!0,onSuccess:()=>{console.log(`Saved ${t}s chunk`),r.value={scores:[],slouchFrames:0,totalFrames:0,alerts:0}},onError:S=>console.error(S)})},Z=a=>{if(a){w||(w=Date.now());const t=(Date.now()-w)/1e3;t>=15?(s.value="CRITICAL: SIT UP!",Date.now()-z>15e3&&(new Notification("Posture Alert",{body:"Sit up straight!"}),J.play().catch(()=>{}),r.value.alerts++,z=Date.now(),f.error("Please sit up straight immediately!","Posture Critical"))):t>=5?s.value="Warning: Adjust Posture":s.value="Slouching Detected"}else w&&(Date.now()-w)/1e3>5?(R.play().catch(()=>{}),s.value="Great Correction!",setTimeout(()=>{v.value||(s.value="Good Posture")},2e3)):s.value="Good Posture",w=null},U=()=>{if(i.value)return;if(!p.value){f.error("I can't see you clearly! Please step back and show your full body.","Calibration Failed");return}o.value=!1,b.value=[],i.value=!0,D.value=5,s.value="Sit Up Straight...";const a=setInterval(()=>{D.value--,D.value<=0&&(clearInterval(a),ee())},1e3)},ee=()=>{if(b.value.length<1){i.value=!1,f.error("You moved or disappeared during calibration. Please try again.","Calibration Failed"),s.value="Calibration Failed";return}const a=b.value.filter(t=>t.back>0&&t.neck>0);if(a.length===0){i.value=!1,f.error("Data was blurry. Ensure good lighting.","Calibration Failed");return}L.value=a.reduce((t,m)=>t+m.back,0)/a.length,j.value=a.reduce((t,m)=>t+m.neck,0)/a.length,o.value=!0,i.value=!1,s.value="Monitoring Started",f.success("Baseline set! We are now tracking your posture.","Calibration Complete"),R.play(),T=Date.now(),_&&clearInterval(_),_=setInterval(O,3e4)},te=async a=>{const t=Date.now();if(!a.poseLandmarks||a.poseLandmarks.length<25){p.value=!1,s.value="Searching for body...";return}const m=a.poseLandmarks,M=.5;if(![8,12,24,23,11,7].every(n=>m[n].visibility>M)){p.value=!1,s.value="Please align with camera";return}if(m[24].y<.4){p.value=!0,s.value="Standing - Paused";return}if(p.value=!0,!(t-V<200)){V=t;try{const n=await W.post(K,{landmarks:a.poseLandmarks,ideal_back:L.value,ideal_neck:j.value});if(n.data.status!=="active"){s.value=n.data.message;return}if(N.value=n.data.angles,i.value&&(n.data.label===1?s.value="Sit Straighter!":(b.value.push(n.data.angles),b.value.length>15&&b.value.shift())),o.value){const S=n.data.score;k.value.push(S),k.value.length>5&&k.value.shift();const B=k.value.reduce((se,le)=>se+le,0)/k.value.length,q=Math.round(B);Math.abs(g.value-q)>=1&&(g.value=q),v.value=n.data.label===1||g.value<75,Z(v.value),r.value.scores.push(g.value),r.value.totalFrames++,v.value&&r.value.slouchFrames++}}catch{console.error("AI Communication Error")}}},ae=async()=>{try{const a=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}}});A=new window.Camera(F.value,{onFrame:async()=>{y&&await y.send({image:F.value})},width:640,height:480}),A.start(),d.value=!0,o.value=!1,P.value=0,C&&clearInterval(C),C=setInterval(()=>{P.value++},1e3)}catch(a){f.error("Please check browser permissions.","Camera Access Denied"),console.error(a)}},G=()=>{d.value=!1,o.value=!1,i.value=!1,_&&(O(),clearInterval(_)),C&&clearInterval(C),A&&A.stop()};return re(()=>G()),(a,t)=>(u(),ie(oe,null,{default:ue(()=>[e("div",fe,[e("div",pe,[e("div",ge,[t[0]||(t[0]=e("div",null,[e("h2",{class:"text-2xl md:text-3xl font-black text-white tracking-tighter"},[ce(" ERGO"),e("span",{class:"text-indigo-500"},"VISION")]),e("p",{class:"text-slate-400 text-[10px] md:text-sm font-mono uppercase tracking-widest"}," AI Posture Engine ")],-1)),e("div",he,[d.value?(u(),c("div",xe,h(Q.value),1)):x("",!0),e("div",be,[e("div",{class:I(["h-2 w-2 md:h-3 md:w-3 rounded-full animate-pulse",o.value?"bg-emerald-500":d.value?"bg-amber-500":"bg-red-500"])},null,2),e("span",we,h(o.value?"ACTIVE":d.value?"STANDBY":"OFFLINE"),1)])])]),e("div",{class:I(["relative w-full max-w-4xl aspect-video bg-black rounded-2xl md:rounded-3xl overflow-hidden shadow-2xl transition-all duration-500 group mx-4",[o.value&&v.value?"shadow-red-900/40 ring-2 ring-red-500":o.value?"shadow-emerald-900/40 ring-2 ring-emerald-500":i.value?"ring-2 ring-amber-400":"ring-1 ring-slate-700"]])},[e("video",{ref_key:"videoRef",ref:F,class:"w-full h-full object-cover transform scale-x-[-1]",autoplay:"",playsinline:""},null,512),d.value&&!p.value?(u(),c("div",ke,[...t[1]||(t[1]=[e("svg",{class:"animate-spin h-8 w-8 text-indigo-500 mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),e("p",{class:"text-white font-mono text-[10px] uppercase tracking-widest"},"Detecting...",-1)])])):x("",!0),d.value&&p.value&&!o.value&&!i.value?(u(),c("div",ye,[e("div",{class:"text-center max-w-sm"},[t[3]||(t[3]=e("div",{class:"text-4xl mb-2"},"ðŸ§˜",-1)),t[4]||(t[4]=e("h3",{class:"text-white font-bold text-xl mb-1"},"Calibration",-1)),t[5]||(t[5]=e("p",{class:"text-slate-300 text-xs mb-4"}," Sit straight. Click start. Hold for 5s. ",-1)),e("button",{onClick:U,class:"w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-xl shadow-lg transition-all flex items-center justify-center gap-2"},[...t[2]||(t[2]=[e("span",null,"START 5s LOCK",-1)])])])])):x("",!0),i.value?(u(),c("div",_e,[e("h2",Ce,h(D.value),1),t[6]||(t[6]=e("p",{class:"text-amber-400 font-bold uppercase tracking-widest text-xs animate-pulse mt-2"},"Don't Move",-1))])):x("",!0),o.value?(u(),c("div",Se,[e("div",Ie,[e("div",De,[t[7]||(t[7]=e("div",{class:"text-[8px] text-slate-400 uppercase tracking-widest font-bold mb-0.5"},"Score",-1)),e("div",{class:I(["text-3xl md:text-4xl font-black tracking-tight leading-none",g.value>85?"text-emerald-400":g.value>70?"text-amber-400":"text-red-500"])},h(g.value),3)]),e("div",Pe,[e("div",Ae,[e("span",Fe,[v.value?(u(),c("span",Ne)):x("",!0),e("span",{class:I(["relative inline-flex rounded-full h-2 w-2",v.value?"bg-red-500":"bg-emerald-500"])},null,2)]),e("span",{class:I(["font-bold uppercase tracking-wider text-[10px] md:text-xs",v.value?"text-red-400":"text-emerald-400"])},h(s.value),3)])])]),e("div",Te,[e("div",Me,[e("div",Be," N:"+h(N.value.neck)+"Â° B:"+h(N.value.back)+"Â° ",1)])])])):x("",!0)],2),e("div",Ee,[d.value?(u(),c("div",Le,[e("button",{onClick:G,class:"flex-1 py-3 bg-slate-800 hover:bg-red-600 hover:text-white text-slate-200 font-bold rounded-xl transition-colors shadow-lg border border-slate-700 uppercase tracking-wider text-xs md:text-sm"}," End Session "),o.value?(u(),c("button",{key:0,onClick:U,class:"px-4 py-3 bg-slate-800 hover:bg-slate-700 text-indigo-400 hover:text-indigo-300 font-bold rounded-xl transition-colors shadow-lg border border-slate-700",title:"Reset Baseline"},[...t[8]||(t[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])])):x("",!0)])):(u(),c("button",{key:0,onClick:ae,class:"w-full py-4 bg-indigo-600 hover:bg-indigo-500 text-white font-bold text-lg rounded-2xl shadow-lg transition-all uppercase tracking-widest"}," Start Camera "))])])])]),_:1}))}};export{Ge as default};
