import{_ as K}from"./AuthenticatedLayout-BfIZ3qXV.js";import{u as Y}from"./ToastList-wS6e8BuQ.js";import{k as n,K as J,x as X,p as Z,E as ee,G as te,q as ae,w as se,b as e,d as oe,t as b,u as t,o as E,c as y,i as B,n as R}from"./app-Vz2Uy-7H.js";import"./ApplicationLogo-BBeubHi3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function le(z,f){const p=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"http://127.0.0.1:5000/predict":"https://ergovision-ai.onrender.com/predict",T=n(!1),g=n(!1),x=n(!1),u=n(!1),w=n(0),l=n(100),k=n(!1),s=n("Initializing..."),S=n(0),_=n({neck:0,back:0}),m=n([]),v=new Audio("/sounds/alert.mp3"),h=new Audio("/sounds/success.mp3");let I=0,C=0,r=[],i=Date.now(),A=0,D=null,M=0,O=null;const c=n({scores:[],slouchFrames:0,totalFrames:0,alerts:0}),G=X(()=>{const a=Math.floor(S.value/60).toString().padStart(2,"0"),o=(S.value%60).toString().padStart(2,"0");return`${a}:${o}`}),H=a=>{if(a){D||(D=Date.now());const o=(Date.now()-D)/1e3;o>=60?(s.value="CRITICAL: POSTURAL RESET REQUIRED",f.error("High-risk duration exceeded. Please stand up and reset.",{timeout:0})):o>=15?(s.value="ALERT: SUSTAINED SLOUCH",Date.now()-M>15e3&&(Notification.permission==="granted"&&new Notification("Posture Alert",{body:"Audible Intervention Triggered."}),v.play().catch(()=>{}),c.value.alerts++,M=Date.now(),f.warning("Persistent deviation detected."))):o>=5?s.value="WARNING: DRIFT DETECTED":s.value="Monitoring Threshold..."}else D&&(Date.now()-D)/1e3>5?(h.play().catch(()=>{}),s.value="Stable State Restored"):s.value="Stable State",D=null},V=()=>{if(c.value.totalFrames===0)return;const a=Date.now(),o=Math.round((a-i)/1e3);i=a;const P=c.value.scores.length||1,j=Math.round(c.value.scores.reduce((L,U)=>L+U,0)/P),d=c.value.slouchFrames/c.value.totalFrames,F=Math.round(d*o);Z.post("/posture-chunks",{score:j,slouch_duration:F,duration_seconds:o,alert_count:c.value.alerts},{preserveScroll:!0,onSuccess:()=>{c.value={scores:[],slouchFrames:0,totalFrames:0,alerts:0}}})},$=async a=>{const o=Date.now();if(!a.poseLandmarks||a.poseLandmarks.length<25){g.value=!1,s.value="Searching...";return}const P=a.poseLandmarks;if(![8,12,24].every(d=>P[d].visibility>.5)){g.value=!1,s.value="Align with camera";return}if(P[24].y<.4){s.value="Standing - Paused";return}if(g.value=!0,!(o-A<200)){A=o;try{const d=await J.post(p,{landmarks:a.poseLandmarks,ideal_back:I,ideal_neck:C,is_calibrating:u.value});if(d.data.status==="calibration_error"){s.value="BAD POSTURE DETECTED";return}if(_.value=d.data.angles,u.value&&(r.push(d.data.angles),s.value="Sit Straight..."),x.value){m.value.push(d.data.score),m.value.length>5&&m.value.shift();const F=m.value.reduce((U,q)=>U+q,0)/m.value.length,L=Math.round(F);Math.abs(l.value-L)>=1&&(l.value=L),k.value=d.data.label===1||l.value<75,H(k.value),c.value.scores.push(l.value),c.value.totalFrames++,k.value&&c.value.slouchFrames++}}catch{s.value="AI Offline"}}},Q=()=>{u.value=!0,w.value=5,r=[];const a=setInterval(()=>{s.value!=="BAD POSTURE DETECTED"&&w.value--,w.value<=0&&(clearInterval(a),W())},1e3)},W=()=>{if(r.length<5){u.value=!1,f.error("Calibration failed. Please sit straight.");return}I=r.reduce((a,o)=>a+o.back,0)/r.length,C=r.reduce((a,o)=>a+o.neck,0)/r.length,x.value=!0,u.value=!1,f.success("Calibration complete!"),h.play().catch(()=>{}),i=Date.now(),O=setInterval(V,3e4)};return{isCameraOn:T,isDetected:g,isCalibrated:x,isLocking:u,calibrationCountdown:w,currentScore:l,isSlouching:k,statusMessage:s,formattedDuration:G,angles:_,onResults:$,triggerCalibration:Q,sessionDurationSecs:S,cleanup:()=>{O&&clearInterval(O),x.value&&V()}}}const ne={class:"py-6 md:py-12 bg-slate-900 min-h-screen"},ie={class:"max-w-5xl mx-auto flex flex-col items-center px-4"},re={class:"w-full flex justify-between items-end mb-8"},ce={class:"text-slate-400 text-[10px] uppercase font-bold tracking-widest"},ue={key:0,class:"text-right tabular-nums"},de={class:"text-2xl font-mono font-bold text-white"},fe={key:0,class:"absolute inset-0 flex flex-col items-center justify-center bg-slate-950/90 backdrop-blur-md z-50"},pe={key:1,class:"absolute inset-0 p-8 flex flex-col justify-between pointer-events-none"},me={class:"flex justify-between items-start"},ve={class:"bg-slate-950/80 backdrop-blur-md p-4 rounded-3xl border border-white/10 shadow-2xl"},he={class:"bg-slate-950/80 backdrop-blur-md px-6 py-3 rounded-full border border-white/10 flex items-center gap-3"},be={class:"text-xs font-black uppercase tracking-widest text-white"},ge={class:"mt-10 w-full max-w-xl"},xe={key:1,class:"flex gap-4"},_e={__name:"PostureCamera",setup(z){const f=n(null),N=Y(),{isCameraOn:p,isCalibrated:T,isLocking:g,calibrationCountdown:x,currentScore:u,isSlouching:w,statusMessage:l,formattedDuration:k,onResults:s,triggerCalibration:S,sessionDurationSecs:_,cleanup:m}=le(f,N);let v=null,h=null;ee(()=>{window.Pose&&(v=new window.Pose({locateFile:r=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${r}`}),v.setOptions({modelComplexity:1,smoothLandmarks:!0,minDetectionConfidence:.5}),v.onResults(s))});const I=async()=>{try{h=new window.Camera(f.value,{onFrame:async()=>{v&&await v.send({image:f.value})},width:640,height:480}),h.start(),p.value=!0,_.value=0,setInterval(()=>{p.value&&_.value++},1e3)}catch{N.error("Camera Access Denied")}},C=()=>{h&&h.stop(),p.value=!1,m()};return te(()=>C()),(r,i)=>(E(),ae(K,null,{default:se(()=>[e("div",ne,[e("div",ie,[e("div",re,[e("div",null,[i[1]||(i[1]=e("h2",{class:"text-3xl font-black text-white tracking-tighter uppercase"},[oe("ERGO"),e("span",{class:"text-indigo-500"},"VISION")],-1)),e("p",ce,b(t(T)?"ACTIVE":"READY"),1)]),t(p)?(E(),y("div",ue,[i[2]||(i[2]=e("p",{class:"text-[10px] font-black text-indigo-400 uppercase mb-1"},"Duration",-1)),e("p",de,b(t(k)),1)])):B("",!0)]),e("div",{class:R(["relative w-full aspect-video bg-black rounded-[3rem] overflow-hidden shadow-2xl border border-white/5",{"ring-4 ring-emerald-500/50":t(l)==="Stable State","ring-4 ring-amber-500/50 animate-pulse":t(l)==="WARNING: DRIFT DETECTED","ring-4 ring-rose-500 shadow-rose-900/40":t(l)==="ALERT: SUSTAINED SLOUCH","ring-8 ring-rose-700 shadow-2xl":t(l)==="CRITICAL: POSTURAL RESET REQUIRED"}])},[e("video",{ref_key:"videoRef",ref:f,class:"w-full h-full object-cover scale-x-[-1]",autoplay:"",playsinline:""},null,512),t(g)?(E(),y("div",fe,[e("h2",{class:R(["text-[10rem] font-black leading-none",t(l)==="BAD POSTURE DETECTED"?"text-rose-500":"text-white"])},b(t(x)),3),e("p",{class:R(["font-black uppercase tracking-[0.3em] text-xs mt-4",t(l)==="BAD POSTURE DETECTED"?"text-rose-400 animate-pulse":"text-amber-400"])},b(t(l)==="BAD POSTURE DETECTED"?"Sit Straight to Resume":"Calibrating Baseline..."),3)])):B("",!0),t(T)?(E(),y("div",pe,[e("div",me,[e("div",ve,[i[3]||(i[3]=e("p",{class:"text-[10px] font-black text-slate-500 uppercase mb-1"},"Efficiency",-1)),e("div",{class:R(["text-5xl font-black tabular-nums",t(u)>85?"text-emerald-400":t(u)>70?"text-amber-400":"text-rose-500"])},b(t(u))+"% ",3)]),e("div",he,[e("span",{class:R(["h-3 w-3 rounded-full",t(w)?"bg-rose-500 animate-ping":"bg-emerald-500"])},null,2),e("span",be,b(t(l)),1)])])])):B("",!0)],2),e("div",ge,[t(p)?(E(),y("div",xe,[e("button",{onClick:C,class:"flex-1 py-4 bg-slate-800 text-white font-black rounded-2xl border border-white/5 uppercase text-xs"},"End Session"),e("button",{onClick:i[0]||(i[0]=(...A)=>t(S)&&t(S)(...A)),class:"flex-[2] py-4 bg-indigo-600 text-white font-black rounded-2xl shadow-xl uppercase text-xs"},b(t(T)?"Recalibrate":"Start 5s Lock"),1)])):(E(),y("button",{key:0,onClick:I,class:"w-full py-5 bg-indigo-600 hover:bg-indigo-500 text-white font-black rounded-[2rem] shadow-2xl uppercase tracking-widest"}," Initialize Engine "))])])])]),_:1}))}};export{_e as default};
