import{_ as q}from"./AuthenticatedLayout-CI4GnKHb.js";import{u as H}from"./ToastList-CJOcPTk1.js";import{k as s,K,x as Y,p as J,E as Q,G as W,q as X,w as Z,b as e,d as ee,t as b,u as t,o as E,c as T,i as F,n as I}from"./app-DuSPyX2C.js";import"./ApplicationLogo-DBhKtJo5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function te(N,p){const m=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"http://127.0.0.1:5000/predict":"https://ergovision-ai.onrender.com/predict",y=s(!1),x=s(!1),g=s(!1),i=s(!1),w=s(0),o=s(100),k=s(!1),l=s("Initializing..."),_=s(0),C=s({neck:0,back:0}),v=s([]);let f=0,h=0,d=[],D=Date.now(),S=0,n=null,R=null;const c=s({scores:[],slouchFrames:0,totalFrames:0,alerts:0}),U=Y(()=>{const a=Math.floor(_.value/60).toString().padStart(2,"0"),r=(_.value%60).toString().padStart(2,"0");return`${a}:${r}`}),L=()=>{if(c.value.totalFrames===0)return;const a=Date.now(),r=Math.round((a-D)/1e3);D=a;const P=c.value.scores.length||1,M=Math.round(c.value.scores.reduce((A,B)=>A+B,0)/P),u=Math.round(c.value.slouchFrames/c.value.totalFrames*r);J.post("/posture-chunks",{score:M,slouch_duration:u,duration_seconds:r,alert_count:c.value.alerts},{preserveScroll:!0,onSuccess:()=>{c.value={scores:[],slouchFrames:0,totalFrames:0,alerts:0}}})},V=async a=>{const r=Date.now();if(!a.poseLandmarks||a.poseLandmarks.length<25){x.value=!1,l.value="Searching...";return}const P=a.poseLandmarks;if(![8,12,24].every(u=>P[u].visibility>.5)){x.value=!1,l.value="Align with camera";return}if(P[24].y<.4){l.value="Standing - Paused";return}if(x.value=!0,!(r-S<200)){S=r;try{const u=await K.post(m,{landmarks:a.poseLandmarks,ideal_back:f,ideal_neck:h,is_calibrating:i.value});if(u.data.status==="calibration_error"){l.value="BAD POSTURE DETECTED";return}if(C.value=u.data.angles,i.value&&(d.push(u.data.angles),l.value="Sit Straight..."),g.value){v.value.push(u.data.score),v.value.length>5&&v.value.shift();const A=v.value.reduce(($,G)=>$+G,0)/v.value.length,B=Math.round(A);Math.abs(o.value-B)>=1&&(o.value=B),k.value=u.data.label===1||o.value<75,l.value=k.value?"Slouching Detected":"Good Posture",c.value.scores.push(o.value),c.value.totalFrames++,k.value&&c.value.slouchFrames++}}catch{l.value="AI Offline"}}},j=()=>{i.value=!0,w.value=5,d=[];const a=setInterval(()=>{l.value!=="BAD POSTURE DETECTED"&&w.value--,w.value<=0&&(clearInterval(a),z())},1e3)},z=()=>{if(d.length<5){i.value=!1,p.error("Calibration failed. Sit straight.");return}f=d.reduce((a,r)=>a+r.back,0)/d.length,h=d.reduce((a,r)=>a+r.neck,0)/d.length,g.value=!0,i.value=!1,p.success("Monitoring started!"),D=Date.now(),R=setInterval(L,3e4)};return{isCameraOn:y,isDetected:x,isCalibrated:g,isLocking:i,calibrationCountdown:w,currentScore:o,isSlouching:k,statusMessage:l,formattedDuration:U,angles:C,onResults:V,triggerCalibration:j,sessionDurationSecs:_,durationInterval:n,cleanup:()=>{clearInterval(n),clearInterval(R),g.value&&L()}}}const ae={class:"py-6 md:py-12 bg-slate-900 min-h-screen"},se={class:"max-w-5xl mx-auto flex flex-col items-center px-4"},oe={class:"w-full flex justify-between items-end mb-8"},le={class:"text-slate-400 text-[10px] uppercase font-bold tracking-widest"},ne={key:0,class:"text-right tabular-nums"},re={class:"text-2xl font-mono font-bold text-white"},ie={key:0,class:"absolute inset-0 flex flex-col items-center justify-center bg-slate-950/90 backdrop-blur-md z-50"},ce={key:1,class:"absolute inset-0 p-8 flex flex-col justify-between pointer-events-none"},ue={class:"flex justify-between items-start"},de={class:"bg-slate-950/80 backdrop-blur-md p-4 rounded-3xl border border-white/10 shadow-2xl"},fe={class:"bg-slate-950/80 backdrop-blur-md px-6 py-3 rounded-full border border-white/10 flex items-center gap-3"},pe={class:"text-xs font-black uppercase tracking-widest text-white"},me={class:"mt-10 w-full max-w-xl"},ve={key:1,class:"flex gap-4"},_e={__name:"PostureCamera",setup(N){const p=s(null),O=H(),{isCameraOn:m,isCalibrated:y,isLocking:x,calibrationCountdown:g,currentScore:i,isSlouching:w,statusMessage:o,formattedDuration:k,onResults:l,triggerCalibration:_,sessionDurationSecs:C,cleanup:v}=te(p,O);let f=null,h=null;Q(()=>{window.Pose&&(f=new window.Pose({locateFile:S=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${S}`}),f.setOptions({modelComplexity:1,smoothLandmarks:!0,minDetectionConfidence:.5}),f.onResults(l))});const d=async()=>{try{h=new window.Camera(p.value,{onFrame:async()=>{f&&await f.send({image:p.value})},width:640,height:480}),h.start(),m.value=!0,C.value=0,setInterval(()=>{m.value&&C.value++},1e3)}catch{O.error("Camera Access Denied")}},D=()=>{h&&h.stop(),m.value=!1,v()};return W(()=>D()),(S,n)=>(E(),X(q,null,{default:Z(()=>[e("div",ae,[e("div",se,[e("div",oe,[e("div",null,[n[1]||(n[1]=e("h2",{class:"text-3xl font-black text-white tracking-tighter uppercase"},[ee("ERGO"),e("span",{class:"text-indigo-500"},"VISION")],-1)),e("p",le,b(t(y)?"ACTIVE":"READY"),1)]),t(m)?(E(),T("div",ne,[n[2]||(n[2]=e("p",{class:"text-[10px] font-black text-indigo-400 uppercase mb-1"},"Duration",-1)),e("p",re,b(t(k)),1)])):F("",!0)]),e("div",{class:I(["relative w-full aspect-video bg-black rounded-[3rem] overflow-hidden shadow-2xl border border-white/5",{"ring-4 ring-rose-500 shadow-rose-900/20":t(o)==="BAD POSTURE DETECTED"}])},[e("video",{ref_key:"videoRef",ref:p,class:"w-full h-full object-cover scale-x-[-1]",autoplay:"",playsinline:""},null,512),t(x)?(E(),T("div",ie,[e("h2",{class:I(["text-[10rem] font-black leading-none",t(o)==="BAD POSTURE DETECTED"?"text-rose-500":"text-white"])},b(t(g)),3),e("p",{class:I(["font-black uppercase tracking-[0.3em] text-xs mt-4",t(o)==="BAD POSTURE DETECTED"?"text-rose-400 animate-pulse":"text-amber-400"])},b(t(o)==="BAD POSTURE DETECTED"?"Sit Straight to Resume":"Calibrating Baseline..."),3)])):F("",!0),t(y)?(E(),T("div",ce,[e("div",ue,[e("div",de,[n[3]||(n[3]=e("p",{class:"text-[10px] font-black text-slate-500 uppercase mb-1"},"Efficiency",-1)),e("div",{class:I(["text-5xl font-black tabular-nums",t(i)>85?"text-emerald-400":t(i)>70?"text-amber-400":"text-rose-500"])},b(t(i))+"% ",3)]),e("div",fe,[e("span",{class:I(["h-3 w-3 rounded-full",t(w)?"bg-rose-500 animate-ping":"bg-emerald-500"])},null,2),e("span",pe,b(t(o)),1)])])])):F("",!0)],2),e("div",me,[t(m)?(E(),T("div",ve,[e("button",{onClick:D,class:"flex-1 py-4 bg-slate-800 text-white font-black rounded-2xl border border-white/5 uppercase text-xs"},"End Session"),e("button",{onClick:n[0]||(n[0]=(...R)=>t(_)&&t(_)(...R)),class:"flex-[2] py-4 bg-indigo-600 text-white font-black rounded-2xl shadow-xl uppercase text-xs"},b(t(y)?"Recalibrate":"Start 5s Lock"),1)])):(E(),T("button",{key:0,onClick:d,class:"w-full py-5 bg-indigo-600 hover:bg-indigo-500 text-white font-black rounded-[2rem] shadow-2xl uppercase tracking-widest"}," Initialize Engine "))])])])]),_:1}))}};export{_e as default};
